<div class="comment-container"
     [class.pinned]="comment.isPinned"
     [class.unread]="comment.isNotifiedToMeAndUnread"
     [class.hidden]="comment.isHidden">
  <div class="comment-header">
    <span class="author-name">{{ comment.author.name }}</span>
    <span class="date">{{ comment.createdAt | date:'short' }}</span>

    @if (comment.isPinned) {
      <span class="badge pinned-badge">üìå –ó–∞–∫—Ä—ñ–ø–ª–µ–Ω–æ</span>
    }
    @if (comment.isHidden) {
      <span class="badge hidden-badge">üëÅÔ∏è –ü—Ä–∏—Ö–æ–≤–∞–Ω–æ</span>
    }
  </div>

  @if (activeAction() === 'edit') {
    <app-comment-form
      [initialValue]="comment"
      submitLabel="–ó–±–µ—Ä–µ–≥—Ç–∏"
      (cancel)="cancelAction()"
      (save)="onFormSave($event)">
    </app-comment-form>
  } @else {
    <div class="comment-body">
      <p>{{ comment.text }}</p>
    </div>

    <div class="comment-actions">
      @if (canReply) {
        <button (click)="startReply()" class="btn-text">–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏</button>
      }

      @if (isAuthor || isAdmin) {
        <button (click)="startEdit()" class="btn-text">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
      }

      @if (isAdmin) {
        <button (click)="delete.emit(comment.id)" class="btn-text text-danger">–í–∏–¥–∞–ª–∏—Ç–∏</button>
        @if (!comment.isHidden) {
          <button (click)="hide.emit(comment)" class="btn-text">–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏</button>
        }
      }

      @if ((isAuthor || isAdmin) && !comment.parentId) {
        @if (comment.isPinned) {
          <button (click)="unpin.emit(comment)" class="btn-text">–í—ñ–¥–∫—Ä—ñ–ø–∏—Ç–∏</button>
        } @else {
          <button (click)="pin.emit(comment)" class="btn-text">–ó–∞–∫—Ä—ñ–ø–∏—Ç–∏</button>
        }
      }
    </div>
  }

  @if (activeAction() === 'reply') {
    <div class="reply-form-container">
      <app-comment-form
        submitLabel="–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏"
        (cancel)="cancelAction()"
        (save)="onFormSave($event)">
      </app-comment-form>
    </div>
  }

</div>

@if (comment.replies && comment.replies.length > 0) {
  <div class="replies-container">
    @for (replyComment of comment.replies; track replyComment.id) {
      <app-comment-thread
        [comment]="replyComment"
        (reply)="reply.emit($event)"
        (update)="update.emit($event)"
        (delete)="delete.emit($event)"
        (pin)="pin.emit($event)"
        (unpin)="unpin.emit($event)"
        (hide)="hide.emit($event)">
      </app-comment-thread>
    }
  </div>
}
