<div class="chat-modal">
  <div class="chat-header">
    <div class="chat-title">
      –û–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –æ–± º—î–∫—Ç—É
    </div>
    <button class="chat-icon-button" type="button" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">
      <span class="icon icon-close"></span>
    </button>
  </div>

  <div class="chat-columns">
    <app-topic-list
      [topics]="(topics$ | async) || []"
      [selectedTopicId]="(selectedTopicId$ | async)"
      (selectTopic)="onSelectTopic($event)"
      (createTopic)="onCreateTopic()">
    </app-topic-list>

    <section class="chat-content-area">

      @if (selectedTopicId$ | async; as topicId) {
        @if (pinnedMessage$ | async; as pinnedMsg) {
          <!-- TODO: scroll to message -->
          <div class="pinned-header" (click)="onPinnedMessageClick(pinnedMsg.id)">
            <div class="pinned-bar"></div>
            <div class="pinned-content">
              <div class="pinned-title">–ó–∞–∫—Ä—ñ–ø–ª–µ–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</div>
              <div class="pinned-text">{{ pinnedMsg.text }}</div>
            </div>
            <button class="pinned-close" (click)="onPin(pinnedMsg); $event.stopPropagation()">‚úï</button>
          </div>
        }

        @if (topicId === 'new') {
          <div class="new-topic-header">
            <h4>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Ç–µ–º–∏</h4>
            <p>–ù–∞–ø–∏—à—ñ—Ç—å –ø–µ—Ä—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —â–æ–± –ø–æ—á–∞—Ç–∏ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è.</p>
          </div>
        }

        <app-message-list
          [messages]="(messages$ | async) || []"
          [currentUserId]="currentUserId"
          (pin)="onPin($event)"
          (hide)="onHide($event)"
          (delete)="onDelete($event)"
          (edit)="onEdit($event)"
          (reply)="onReply($event)"
          (quoteClick)="onQuoteClick($event)"
        >
        </app-message-list>

        <div class="chat-footer">
          <app-chat-input
            [replyTo]="replyToMessage()"
            [editingMessage]="editingMessage()"
            (cancelContext)="cancelInputContext()"
            (send)="onSendMessage($event, topicId)">
          </app-chat-input>
        </div>

      } @else {
        <div class="empty-selection-state">
          <div class="empty-icon">üí¨</div>
          <p>–û–±–µ—Ä—ñ—Ç—å —Ç–µ–º—É –∑–ª—ñ–≤–∞ –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É</p>
        </div>
      }
    </section>
  </div>
</div>
